<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>add_osm_suface — add_osm_surface • osmplotr</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="add_osm_suface — add_osm_surface" />

<meta property="og:description" content="Adds a colour-coded surface of spatial objects (polygons, lines, or points
generated by extract_osm_objects to a graphics object
initialised with osm_basemap. The surface is spatially
interpolated between the values given in dat, which has to be a matrix or
data.frame of 3 columns (x, y, z), where (x,y) are (longitude,
latitude), and z are the values to be interpolated. Interpolation uses
spatstat::Smoothing.ppp, which applies a Gaussian kernel smoother
optimised to the given data, and is effectively non-parametric." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">osmplotr</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ropensci/osmplotr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>add_osm_suface</h1>
    <small class="dont-index">Source: <a href='https://github.com/ropensci/osmplotr/blob/master/R/add-osm-surface.R'><code>R/add-osm-surface.R</code></a></small>
    <div class="hidden name"><code>add_osm_surface.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Adds a colour-coded surface of spatial objects (polygons, lines, or points
generated by <code><a href='extract_osm_objects.html'>extract_osm_objects</a></code> to a graphics object
initialised with <code><a href='osm_basemap.html'>osm_basemap</a></code>. The surface is spatially
interpolated between the values given in <code>dat</code>, which has to be a matrix or
<code>data.frame</code> of 3 columns (x, y, z), where (x,y) are (longitude,
latitude), and z are the values to be interpolated. Interpolation uses
<code>spatstat::Smoothing.ppp</code>, which applies a Gaussian kernel smoother
optimised to the given data, and is effectively non-parametric.</p>
    
    </div>

    <pre class="usage"><span class='fu'>add_osm_surface</span>(<span class='no'>map</span>, <span class='no'>obj</span>, <span class='no'>dat</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"idw"</span>, <span class='kw'>grid_size</span> <span class='kw'>=</span> <span class='fl'>100</span>,
  <span class='kw'>cols</span> <span class='kw'>=</span> <span class='fu'>heat.colors</span>(<span class='fl'>30</span>), <span class='no'>bg</span>, <span class='no'>size</span>, <span class='no'>shape</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>map</th>
      <td><p>A <code>ggplot2</code> object to which the surface are to be added</p></td>
    </tr>
    <tr>
      <th>obj</th>
      <td><p>An <code>sp</code> <code>SpatialPolygonsDataFrame</code> or
<code>SpatialLinesDataFrame</code> (list of polygons or lines) returned by
<code><a href='extract_osm_objects.html'>extract_osm_objects</a></code></p></td>
    </tr>
    <tr>
      <th>dat</th>
      <td><p>A matrix or data frame of 3 columns (x, y, z), where (x, y) are
(longitude, latitude), and z are the values to be interpolated</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>Either <code>idw</code> (Inverse Distance Weighting as
<code><a href='http://www.rdocumentation.org/packages/spatstat/topics/idw'>spatstat::idw</a></code>; default), <code>Gaussian</code> for kernel
smoothing (as <code><a href='http://www.rdocumentation.org/packages/spatstat/topics/Smooth.ppp'>spatstat::Smooth.ppp</a></code>), or any other value to avoid
interpolation. In this case, <code>dat</code> must be regularly spaced in <code>x</code>
and <code>y</code>.</p></td>
    </tr>
    <tr>
      <th>grid_size</th>
      <td><p>size of interpolation grid</p></td>
    </tr>
    <tr>
      <th>cols</th>
      <td><p>Vector of colours for shading z-values (for example,
<code>terrain.colors (30)</code>)</p></td>
    </tr>
    <tr>
      <th>bg</th>
      <td><p>If specified, OSM objects outside the convex hull surrounding
<code>dat</code> are plotted in this colour, otherwise they are included in the
interpolation (which will generally be inaccurate for peripheral values)</p></td>
    </tr>
    <tr>
      <th>size</th>
      <td><p>Size argument passed to <code>ggplot2</code> (polygon, path, point)
functions: determines width of lines for (polygon, line), and sizes of
points.  Respective defaults are (0, 0.5, 0.5). If <code>bg</code> is provided and
<code>size</code> has 2 elements, the second determines the <code>size</code> of the
background objects.</p></td>
    </tr>
    <tr>
      <th>shape</th>
      <td><p>Shape of lines or points, for details of which see
<code>?ggplot::shape</code>. If <code>bg</code> is provided and <code>shape</code> has 2
elements, the second determines the <code>shape</code> of the background objects.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>modified version of <code>map</code> to which surface has been added</p>
    
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>Points beyond the spatial boundary of <code>dat</code> are included in the surface
if <code>bg</code> is not given. In such cases, values for these points may exceed
the range of provided data because the surface will be extrapolated beyond
its domain.  Actual plotted values are therefore restricted to the range of
given values, so any extrapolated points greater or less than the range of
<code>dat</code> are simply set to the respective maximum or minimum values. This
allows the limits of <code>dat</code> to be used precisely when adding colourbars
with <code><a href='add_colourbar.html'>add_colourbar</a></code>.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='osm_basemap.html'>osm_basemap</a></code>, <code><a href='add_colourbar.html'>add_colourbar</a></code>.</p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Get some data</span>
<span class='no'>bbox</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='get_bbox.html'>get_bbox</a></span> (<span class='fu'>c</span> (-<span class='fl'>0.13</span>, <span class='fl'>51.5</span>, -<span class='fl'>0.11</span>, <span class='fl'>51.52</span>))
<span class='co'># dat_B &lt;- extract_osm_objects (key = 'building', bbox = bbox)</span>
<span class='co'># These data are also provided in</span>
<span class='no'>dat_B</span> <span class='kw'>&lt;-</span> <span class='no'>london</span>$<span class='no'>dat_BNR</span> <span class='co'># actuall non-residential buildings</span>
<span class='co'># Make a data surface across the map coordinates, and remove periphery</span>
<span class='no'>n</span> <span class='kw'>&lt;-</span> <span class='fl'>5</span>
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'>seq</span> (<span class='no'>bbox</span> [<span class='fl'>1</span>,<span class='fl'>1</span>], <span class='no'>bbox</span> [<span class='fl'>1</span>,<span class='fl'>2</span>], <span class='kw'>length.out</span> <span class='kw'>=</span> <span class='no'>n</span>)
<span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='fu'>seq</span> (<span class='no'>bbox</span> [<span class='fl'>2</span>,<span class='fl'>1</span>], <span class='no'>bbox</span> [<span class='fl'>2</span>,<span class='fl'>2</span>], <span class='kw'>length.out</span> <span class='kw'>=</span> <span class='no'>n</span>)
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='fu'>data.frame</span> (
    <span class='kw'>x</span> <span class='kw'>=</span> <span class='fu'>as.vector</span> (<span class='fu'>array</span> (<span class='no'>x</span>, <span class='kw'>dim</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='no'>n</span>, <span class='no'>n</span>))),
    <span class='kw'>y</span> <span class='kw'>=</span> <span class='fu'>as.vector</span> (<span class='fu'>t</span> (<span class='fu'>array</span> (<span class='no'>y</span>, <span class='kw'>dim</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='no'>n</span>, <span class='no'>n</span>)))),
    <span class='kw'>z</span> <span class='kw'>=</span> <span class='no'>x</span> * <span class='no'>y</span>
    )</div><span class='co'># NOT RUN {</span>
<span class='no'>map</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='osm_basemap.html'>osm_basemap</a></span> (<span class='kw'>bbox</span> <span class='kw'>=</span> <span class='no'>bbox</span>, <span class='kw'>bg</span> <span class='kw'>=</span> <span class='st'>'gray20'</span>)
<span class='no'>map</span> <span class='kw'>&lt;-</span> <span class='fu'>add_osm_surface</span> (<span class='no'>map</span>, <span class='no'>dat_B</span>, <span class='kw'>dat</span> <span class='kw'>=</span> <span class='no'>dat</span>, <span class='kw'>cols</span> <span class='kw'>=</span> <span class='fu'>heat.colors</span> (<span class='fl'>30</span>))
<span class='fu'><a href='print_osm_map.html'>print_osm_map</a></span> (<span class='no'>map</span>)
<span class='co'># }</span><div class='input'>
<span class='co'># If data do not cover the entire map region, then the peripheral remainder can</span>
<span class='co'># be plotted by specifying the 'bg' colour. First remove periphery from</span>
<span class='co'># 'dat':</span>
<span class='no'>d</span> <span class='kw'>&lt;-</span> <span class='fu'>sqrt</span> ((<span class='no'>dat</span>$<span class='no'>x</span> - <span class='fu'>mean</span> (<span class='no'>dat</span>$<span class='no'>x</span>)) ^ <span class='fl'>2</span> + (<span class='no'>dat</span>$<span class='no'>y</span> - <span class='fu'>mean</span> (<span class='no'>dat</span>$<span class='no'>y</span>)) ^ <span class='fl'>2</span>)
<span class='no'>dat</span> <span class='kw'>&lt;-</span> <span class='no'>dat</span> [<span class='fu'>which</span> (<span class='no'>d</span> <span class='kw'>&lt;</span> <span class='fl'>0.01</span>),]</div><span class='co'># NOT RUN {</span>
<span class='no'>map</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='osm_basemap.html'>osm_basemap</a></span> (<span class='kw'>bbox</span> <span class='kw'>=</span> <span class='no'>bbox</span>, <span class='kw'>bg</span> <span class='kw'>=</span> <span class='st'>'gray20'</span>)
<span class='no'>map</span> <span class='kw'>&lt;-</span> <span class='fu'>add_osm_surface</span> (<span class='no'>map</span>, <span class='no'>dat_B</span>, <span class='kw'>dat</span> <span class='kw'>=</span> <span class='no'>dat</span>, <span class='kw'>cols</span> <span class='kw'>=</span> <span class='fu'>heat.colors</span> (<span class='fl'>30</span>), <span class='kw'>bg</span> <span class='kw'>=</span> <span class='st'>'gray40'</span>)
<span class='fu'><a href='print_osm_map.html'>print_osm_map</a></span> (<span class='no'>map</span>)
<span class='co'># }</span><div class='input'>
<span class='co'># Polygons and (lines/points) can be overlaid as data surfaces with different</span>
<span class='co'># colour schemes.</span>
<span class='co'># dat_HP &lt;- extract_osm_objects (key = 'highway', value = 'primary', bbox = bbox)</span>
<span class='co'># These data are also provided in</span>
<span class='no'>dat_HP</span> <span class='kw'>&lt;-</span> <span class='no'>london</span>$<span class='no'>dat_HP</span>
<span class='no'>cols</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='adjust_colours.html'>adjust_colours</a></span> (<span class='fu'>heat.colors</span> (<span class='fl'>30</span>), <span class='kw'>adj</span> <span class='kw'>=</span> -<span class='fl'>0.2</span>) <span class='co'># darken by 20%</span></div><span class='co'># NOT RUN {</span>
<span class='no'>map</span> <span class='kw'>&lt;-</span> <span class='fu'>add_osm_surface</span> (<span class='no'>map</span>, <span class='no'>dat_HP</span>, <span class='no'>dat</span>, <span class='kw'>cols</span> <span class='kw'>=</span> <span class='no'>cols</span>, <span class='kw'>bg</span> <span class='kw'>=</span> <span class='st'>'gray60'</span>, <span class='kw'>size</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>1.5</span>,<span class='fl'>0.5</span>))
<span class='fu'><a href='print_osm_map.html'>print_osm_map</a></span> (<span class='no'>map</span>)
<span class='co'># }</span><div class='input'>
<span class='co'># Adding multiple surfaces of either polygons or (lines/points) produces a</span>
<span class='co'># 'ggplot2' warning, and forces the colour gradient to revert to the last given</span>
<span class='co'># value.</span>
<span class='no'>dat_T</span> <span class='kw'>&lt;-</span> <span class='no'>london</span>$<span class='no'>dat_T</span> <span class='co'># trees</span></div><span class='co'># NOT RUN {</span>
<span class='no'>map</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='osm_basemap.html'>osm_basemap</a></span> (<span class='kw'>bbox</span> <span class='kw'>=</span> <span class='no'>bbox</span>, <span class='kw'>bg</span> <span class='kw'>=</span> <span class='st'>'gray20'</span>)
<span class='no'>map</span> <span class='kw'>&lt;-</span> <span class='fu'>add_osm_surface</span> (<span class='no'>map</span>, <span class='no'>dat_B</span>, <span class='kw'>dat</span> <span class='kw'>=</span> <span class='no'>dat</span>, <span class='kw'>cols</span> <span class='kw'>=</span> <span class='fu'>heat.colors</span> (<span class='fl'>30</span>), <span class='kw'>bg</span> <span class='kw'>=</span> <span class='st'>'gray40'</span>)
<span class='no'>map</span> <span class='kw'>&lt;-</span> <span class='fu'>add_osm_surface</span> (<span class='no'>map</span>, <span class='no'>dat_HP</span>, <span class='no'>dat</span>, <span class='kw'>cols</span> <span class='kw'>=</span> <span class='fu'>heat.colors</span> (<span class='fl'>30</span>), <span class='kw'>bg</span> <span class='kw'>=</span> <span class='st'>'gray60'</span>,
                        <span class='kw'>size</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>1.5</span>,<span class='fl'>0.5</span>))
<span class='no'>map</span> <span class='kw'>&lt;-</span> <span class='fu'>add_osm_surface</span> (<span class='no'>map</span>, <span class='no'>dat_T</span>, <span class='no'>dat</span>, <span class='kw'>cols</span> <span class='kw'>=</span> <span class='fu'>topo.colors</span> (<span class='fl'>30</span>),
                        <span class='kw'>bg</span> <span class='kw'>=</span> <span class='st'>'gray70'</span>, <span class='kw'>size</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>5</span>,<span class='fl'>2</span>), <span class='kw'>shape</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>8</span>, <span class='fl'>1</span>))
<span class='fu'><a href='print_osm_map.html'>print_osm_map</a></span> (<span class='no'>map</span>) <span class='co'># 'dat_HP' is in 'topo.colors' not 'heat.colors'</span>
<span class='co'># }</span><div class='input'>
# Add axes and colourbar
</div><span class='co'># NOT RUN {</span>
<span class='no'>map</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='add_axes.html'>add_axes</a></span> (<span class='no'>map</span>)
<span class='no'>map</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='add_colourbar.html'>add_colourbar</a></span> (<span class='no'>map</span>, <span class='kw'>cols</span> <span class='kw'>=</span> <span class='fu'>heat.colors</span> (<span class='fl'>100</span>), <span class='kw'>zlims</span> <span class='kw'>=</span> <span class='fu'>range</span> (<span class='no'>dat</span>$<span class='no'>z</span>),
                      <span class='kw'>barwidth</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>0.02</span>), <span class='kw'>barlength</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>0.6</span>,<span class='fl'>0.99</span>), <span class='kw'>vertical</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
<span class='fu'><a href='print_osm_map.html'>print_osm_map</a></span> (<span class='no'>map</span>)
<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#note">Note</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Mark Padgham, Richard Beare.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

